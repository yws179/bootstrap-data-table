(function(d){d.fn.dataTable=function(e){var s=arguments;return this.each(function(){var t=d(this),i=t.data("dataTable"),a=typeof e=="object"&&e;if(!i){i=new n(t,a);t.data("dataTable",i)}if("string"===typeof e){i[e].apply(i,Array.prototype.slice.call(s,1))}})};var n=function(t,i){if(!t.is("table")){throw new Error("This is not <table> DOM")}this.$table=t;this.$caption=this.$table.find("caption");this.$thead=this.$table.find("thead");this.$tbody=this.$table.find("tbody");this.$pagination=this.$table.siblings(".pagination");this.options=i||{};this.data=this.options.data||[];this.visibleData=this.data;this.visibleCondition={};this.preProcessor=this.options.preProcessor;this.buttons=this.options.buttons||[];this.refreshable=this.options.refreshable;this.filterable=this.options.filterable;this.operate=this.options.operate;this.pageable=this.options.pageable;this.pageSize=this.options.pageSize||10;this.page=this.options.page||1;this._init()};n.prototype={constructor:n,_init:function(){this.$table.addClass("table table-striped table-bordered table-hover bs-data-table");if(this.$caption.length<1){this.$caption=d("<caption></caption>");this.$table.prepend(this.$caption)}if(this.$thead.length<1){this.$thead=d("<thead></thead>");this.$caption.after(this.$thead)}if(this.$tbody.length<1){this.$tbody=d("<tbody></tbody>");this.$thead.after(this.$tbody)}this.rendCaption();this.renderHead();this.renderData()},rendCaption:function(){var t=d('<div class="btn-group pull-right"></div>');for(var i=0;i<this.buttons.length;i++){var a=this.buttons[i],e=d(a.dom);for(var s in a.events){e.on(s,a.events[s])}t.append(e)}if(this.refreshable){var e=d('<button class="btn btn-default btn-refresh" type="button" title="刷新"><span class="glyphicon glyphicon-refresh"></span></button>');e.on("click",function(){var t=this.$thead.find("tr.bs-data-table-filter");t.find(":input").val("");t.find(":input:first()").change()}.bind(this));t.append(e)}if(this.filterable){t.append('<button class="btn btn-default btn-filter" type="button" title="过滤器"><span class="glyphicon glyphicon-filter"></span></button>')}this.$caption.append(t);if(this.options.title){this.$caption.prepend(this.options.title)}},renderHead:function(){var t=d("<tr></tr>");for(var i in this.options.fields){var a=d('<div class="pull-right"></div>').append('<div class="btn-sort" data-sort-by=":sort-by" data-order="asc"><span class="glyphicon glyphicon-chevron-up"></span></div>'.replace(":sort-by",i)).append('<div class="btn-sort" data-sort-by=":sort-by" data-order="desc"><span class="glyphicon glyphicon-chevron-down"></span></div>'.replace(":sort-by",i));t.append(d("<th>"+this.options.fields[i]+"</th>").append(a))}if(this.operate){t.append("<th>"+(this.options.operate.field||"operate")+"</th>")}this.$thead.prepend(t);var e=this;this.$thead.find(".btn-sort").click(function(){var t=d(this),i=t.data("sort-by"),a=t.data("order");r(e.data,i,a=="desc");e.renderData()});if(this.filterable){if(this.$thead.find(".bs-data-table-filter").length<1){var s=d('<tr class="bs-data-table-filter"></tr>');for(var i in this.options.fields){s.append('<th><input class="form-control" name=":name"></th>'.replace(":name",i))}if(this.operate){s.append('<th><button class="btn btn-default btn-reset-filter"><span class="glyphicon glyphicon-repeat"></span></button></th>')}this.$thead.append(s)}var s=s||this.$thead.find(".bs-data-table-filter");if(this.operate){s.find(".btn-reset-filter").click(function(){var t=s.find(":input");t.val("");t.change()})}this.$caption.find(".btn-filter").click(function(){d(this).toggleClass("active");s.toggle();s.find(":input").val("");s.find(":input:first()").change()});this.$table.on("change keyup paste",".bs-data-table-filter :input",function(){var a={};this.$table.find(".bs-data-table-filter :input").each(function(){var t=d(this).attr("name");var i=d(this).val();if(d(this).data("strict")){p(a,t+"-strict",true)}p(a,t,i)});this.visibleCondition=a;this.renderData()}.bind(this))}},renderData:function(t){this.data=t||this.data;this.visibleData=o(this.data,this.visibleCondition);var i=Math.ceil(this.visibleData.length/this.pageSize);if(this.pageable){if(this.page>i){this.page=i}if(i>0&&this.page<1){this.page=1}this.visibleData=Array.prototype.slice.call(this.visibleData,(this.page-1)*this.pageSize,Math.min(this.page*this.pageSize,this.visibleData.length))}this.$tbody.html("");for(var a=0;a<this.visibleData.length;a++){var e=d("<tr></tr>"),s=this.preProcessor?this.preProcessor(u(this.visibleData[a])):this.visibleData[a];for(var n in this.options.fields){e.append("<td>"+(c(s,n)||"")+"</td>")}if(this.operate){e.append("<td>"+this.operate.content+"</td>")}this.$tbody.append(e)}if(this.pageable){this.renderPagination(i)}},renderPagination:function(t){var i=f(this.page,t),a=d('<div class="bs-data-table-pagination"></div>'),e=d('<select class="form-control bs-data-table-page-select"></select>'),s=d('<ul class="pagination bs-data-table-pagination"></ul>');var n=d('<li data-page="1"><a href="javascript:void(0);">&laquo;</a></li>');if(this.page<=1){n.addClass("disabled")}s.append(n);for(var r=0;r<i.length;r++){var o=d('<li data-page=":num"><a href="javascript:void(0);">:num</a></li>'.replace(/:num/g,i[r]));if(i[r]==this.page){o.addClass("active")}s.append(o)}var h=d('<li data-page=":totalPage"><a href="javascript:void(0);">&raquo;</a></li>'.replace(":totalPage",t));if(this.page==t){h.addClass("disabled")}s.append(h);a.append(s);if(t>0){for(var r=1;r<=t;r++){var p=d('<option value=":page">:page</option>'.replace(/:page/g,r));if(r==this.page){p.prop("selected",true)}e.append(p)}a.append('<span class="bs-data-table-page-total">/&nbsp;:totalPage</span>'.replace(":totalPage",t));a.append(e)}if(this.$pagination.length>0){this.$pagination.replaceWith(a);this.$pagination=a}else{this.$pagination=a;this.$table.after(this.$pagination)}var l=this;a.on("click change",".pagination li, .bs-data-table-page-select",function(){if(d(this).is(".disabled"))return;if(d(this).is("select")){l.page=d(this).val()}else{l.page=d(this).data("page")}l.renderData()})},getIdx:function(t,i){i.apply(this,this.data.indexOf(t))},getData:function(t,i){var a=[];if(t instanceof Array){t.forEach(function(t){a.push(this.data[t])}.bind(this));i.apply(this,[a])}else{i.apply(this,[this.data[t]])}},getAllData:function(t){t.apply(this,this.data)},addData:function(t){if(t instanceof Array){t.forEach(function(t){this.data.push(t)}.bind(this))}else{this.data.push(t)}this.renderData()},removeData:function(t){if(t instanceof Array){t.forEach(function(t){this.data.splice(t,1)}.bind(this))}else{this.data.splice(t,1)}this.renderData()},replaceData:function(t,i){this.data.splice(t,1,i);this.renderData()},event:function(t){var i=this,a,e;if(arguments.length>2){a=arguments[1];e=arguments[2]}else{a="";e=arguments[1]}this.$tbody.on(t,"tr "+a,function(){var t=i.visibleData[d(this).index()];e.apply(this,[i.data.indexOf(t),t])})}};var r=function(t,a,i){t.sort(function(t,i){return e(t,i,a)});if(i){t.reverse()}};var e=function(t,i,a){if(a){t=c(t,a);i=c(i,a)}if(/^\d+$/.test(t)&&/^\d+$/.test(i)){t=Number(t);i=Number(i)}if(t>i||!i){return 1}else if(t<i||!t){return-1}return t.id>i.id?1:-1};var o=function(t,i){var a=[];t.forEach(function(t){if(!s(t,i)){a.push(t)}});return a};var s=function(t,i){for(var a in i){if(!i.hasOwnProperty(a)||a.endsWith("-strict")){continue}if(i[a+"-strict"]&&t[a]!=i[a]){return true}else if((t[a]+"").indexOf(i[a])==-1){return true}}return false};function f(t,i){var a=[],e=5,s=1;if(i<1){a.push(1);return a}if(i<=e){for(var n=1;n<=i;n++){a.push(n)}return a}s=t-Math.floor(e/2);s=s>0?s:1;s=s+e>i?i-e+1:s;for(var n=0;n<e;n++){a.push(s+n)}return a}var h=function(t){return t==undefined||t==""};var p=function(t,i,a,e){if(!h(t)&&!h(i)&&!h(a)){l(t,i,a,e)}};var l=function(t,i,a,e){var s=i.indexOf(".");if(s==-1){if(e=="list"){t[i]=t[i]||[];t[i].push(a)}else{t[i]=a}return}var n=i.substr(0,s);if(h(t[n])){t[n]={}}l(t[n],i.substr(s+1),a,e)};var c=function(t,i){return h(t)||h(i)?undefined:b(t,i)};var b=function(t,i){var a=i.indexOf(".");if(a==-1){return t[i]}var e=i.substr(0,a);if(h(t[e])){t[e]={}}return b(t[e],i.substr(a+1))};function u(t){return JSON.parse(JSON.stringify(t))}})(jQuery);